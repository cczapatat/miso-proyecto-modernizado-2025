<div class="container">
  <h2 class="text-center title">{{ 'USER_EDIT.TITLE' | translate }}</h2>
  
  <div *ngIf="isLoading" class="text-center mt-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">{{ 'COMMON.LOADING' | translate }}</span>
    </div>
    <p>{{ 'COMMON.LOADING_DATA' | translate }}</p>
  </div>

  <div class="form-container" *ngIf="!isLoading">
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
      <input type="hidden" formControlName="id">

      <!-- Personal Information Section -->
      <div class="section-header">
        <h5 class="section-title">{{ 'USER_EDIT.PERSONAL_INFO' | translate }}</h5>
      </div>
      
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="mb-3">
            <label for="user_name" class="form-label">{{ 'USER_EDIT.NAME' | translate }}</label>
            <input id="user_name" type="text" class="form-control" formControlName="name"
              [placeholder]="'USER_EDIT.NAME_PLACEHOLDER' | translate"
              [class.is-invalid]="isFieldInvalid(userForm, 'name')">
            <div id="user_name_error" *ngIf="isFieldInvalid(userForm, 'name')" class="text-danger mt-1">
              {{ getErrorMessage(userForm, 'name') | translate }}
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label for="user_last_name" class="form-label">{{ 'USER_EDIT.LAST_NAME' | translate }}</label>
            <input id="user_last_name" type="text" class="form-control" formControlName="last_name"
              [placeholder]="'USER_EDIT.LAST_NAME_PLACEHOLDER' | translate"
              [class.is-invalid]="isFieldInvalid(userForm, 'last_name')">
            <div id="user_last_name_error" *ngIf="isFieldInvalid(userForm, 'last_name')" class="text-danger mt-1">
              {{ getErrorMessage(userForm, 'last_name') | translate }}
            </div>
          </div>
        </div>
      </div>

      <!-- Basic Measurements Section -->
      <div class="section-header">
        <h5 class="section-title">{{ 'USER_EDIT.BASIC_MEASUREMENTS' | translate }}</h5>
      </div>
      
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="mb-3">
            <label for="user_age" class="form-label">{{ 'USER_EDIT.AGE' | translate }}</label>
            <input id="user_age" type="number" class="form-control" formControlName="age"
              [placeholder]="'USER_EDIT.AGE_PLACEHOLDER' | translate" min="1"
              [class.is-invalid]="isFieldInvalid(userForm, 'age')">
            <div id="user_age_error" *ngIf="isFieldInvalid(userForm, 'age')" class="text-danger mt-1">
              {{ getErrorMessage(userForm, 'age') | translate }}
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label for="user_height" class="form-label">{{ 'USER_EDIT.HEIGHT' | translate }}</label>
            <input id="user_height" type="number" step="0.01" class="form-control" formControlName="height"
              [placeholder]="'USER_EDIT.HEIGHT_PLACEHOLDER' | translate" min="0.01"
              [class.is-invalid]="isFieldInvalid(userForm, 'height')">
            <div id="user_height_error" *ngIf="isFieldInvalid(userForm, 'height')" class="text-danger mt-1">
              {{ getErrorMessage(userForm, 'height') | translate }}
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-6">
          <div class="mb-3">
            <label for="user_weight" class="form-label">{{ 'USER_EDIT.WEIGHT' | translate }}</label>
            <input id="user_weight" type="number" step="0.1" class="form-control" formControlName="weight"
              [placeholder]="'USER_EDIT.WEIGHT_PLACEHOLDER' | translate" min="0.1"
              [class.is-invalid]="isFieldInvalid(userForm, 'weight')">
            <div id="user_weight_error" *ngIf="isFieldInvalid(userForm, 'weight')" class="text-danger mt-1">
              {{ getErrorMessage(userForm, 'weight') | translate }}
            </div>
          </div>
        </div>
      </div>

      <!-- Body Measurements Section -->
      <div class="section-header">
        <h5 class="section-title">{{ 'USER_EDIT.BODY_MEASUREMENTS' | translate }}</h5>
      </div>
      
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="mb-3">
            <label for="user_arm" class="form-label">{{ 'USER_EDIT.ARM' | translate }}</label>
            <input id="user_arm" type="number" step="0.1" class="form-control" formControlName="arm"
              [placeholder]="'USER_EDIT.ARM_PLACEHOLDER' | translate" min="0.1"
              [class.is-invalid]="isFieldInvalid(userForm, 'arm')">
            <div id="user_arm_error" *ngIf="isFieldInvalid(userForm, 'arm')" class="text-danger mt-1">
              {{ getErrorMessage(userForm, 'arm') | translate }}
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label for="user_chest" class="form-label">{{ 'USER_EDIT.CHEST' | translate }}</label>
            <input id="user_chest" type="number" step="0.1" class="form-control" formControlName="chest"
              [placeholder]="'USER_EDIT.CHEST_PLACEHOLDER' | translate" min="0.1"
              [class.is-invalid]="isFieldInvalid(userForm, 'chest')">
            <div id="user_chest_error" *ngIf="isFieldInvalid(userForm, 'chest')" class="text-danger mt-1">
              {{ getErrorMessage(userForm, 'chest') | translate }}
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-6">
          <div class="mb-3">
            <label for="user_waist" class="form-label">{{ 'USER_EDIT.WAIST' | translate }}</label>
            <input id="user_waist" type="number" step="0.1" class="form-control" formControlName="waist"
              [placeholder]="'USER_EDIT.WAIST_PLACEHOLDER' | translate" min="0.1"
              [class.is-invalid]="isFieldInvalid(userForm, 'waist')">
            <div id="user_waist_error" *ngIf="isFieldInvalid(userForm, 'waist')" class="text-danger mt-1">
              {{ getErrorMessage(userForm, 'waist') | translate }}
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label for="user_leg" class="form-label">{{ 'USER_EDIT.LEG' | translate }}</label>
            <input id="user_leg" type="number" step="0.1" class="form-control" formControlName="leg"
              [placeholder]="'USER_EDIT.LEG_PLACEHOLDER' | translate" min="0.1"
              [class.is-invalid]="isFieldInvalid(userForm, 'leg')">
            <div id="user_leg_error" *ngIf="isFieldInvalid(userForm, 'leg')" class="text-danger mt-1">
              {{ getErrorMessage(userForm, 'leg') | translate }}
            </div>
          </div>
        </div>
      </div>

      <!-- Additional Information Section -->
      <div class="section-header">
        <h5 class="section-title">{{ 'USER_EDIT.ADDITIONAL_INFO' | translate }}</h5>
      </div>
      
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="mb-3">
            <label for="user_withdrawal_date" class="form-label">{{ 'USER_EDIT.WITHDRAWAL_DATE' | translate }}</label>
            <input id="user_withdrawal_date" type="date" class="form-control" formControlName="withdrawal_date">
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label for="user_withdrawal_reason" class="form-label">{{ 'USER_EDIT.WITHDRAWAL_REASON' | translate }}</label>
            <textarea id="user_withdrawal_reason" class="form-control" formControlName="withdrawal_reason" 
              rows="3" [placeholder]="'USER_EDIT.WITHDRAWAL_REASON_PLACEHOLDER' | translate"></textarea>
          </div>
        </div>
      </div>

      <!-- Buttons -->
      <div class="text-center">
        <div class="d-flex gap-3 justify-content-center">
          <button id="user_btn_cancel" type="button" class="btn cancel-btn" (click)="onCancel()">
            {{ 'USER_EDIT.CANCEL' | translate }}
          </button>
          <button id="user_btn_save" type="submit" class="btn save-btn"
            [disabled]="userForm.invalid || isSubmitting">
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2" role="status"></span>
            {{ 'USER_EDIT.SAVE' | translate }}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>