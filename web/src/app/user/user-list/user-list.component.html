<div class="container content">
  <div class="row">
    <div class="col-md-8">
      <h2>{{ 'USER_LIST.TITLE' | translate }}</h2>
    </div>
    <div class="col-md-4 text-end">
      <button class="btn btn-primary" (click)="navigateToCreate()">
        <i class="bi bi-plus-circle me-2"></i>{{ 'USER_LIST.CREATE_BUTTON' | translate }}
      </button>
    </div>
  </div>

  <hr>

  <div *ngIf="users.length > 0; else noUsers">
    <div class="table-responsive">
      <table class="table table-striped table-hover mt-3">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">{{ 'USER_LIST.TABLE_HEADER.NAME' | translate }}</th>
            <th scope="col">{{ 'USER_LIST.TABLE_HEADER.LAST_NAME' | translate }}</th>
            <th scope="col">{{ 'USER_LIST.TABLE_HEADER.AGE' | translate }}</th>
            <th scope="col">{{ 'USER_LIST.TABLE_HEADER.ACTIONS' | translate }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users">
            <td>{{ user.id }}</td>
            <td>{{ user.name }}</td>
            <td>{{ user.last_name }}</td>
            <td>{{ user.age }}</td>
            <td>
              <button class="btn btn-sm btn-outline-info me-2" (click)="openDetailModal(user)">
                <i class="bi bi-eye"></i>
              </button>
              <button class="btn btn-sm btn-outline-warning me-2" (click)="navigateToEdit(user.id!)">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger me-2" (click)="openDeleteModal(user)">
                <i class="bi bi-trash"></i>
              </button>
              <button class="btn btn-sm btn-outline-secondary" (click)="openWithdrawModal(user)" [disabled]="user.withdrawal_date">
                <i class="bi bi-person-x"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <nav aria-label="Page navigation" *ngIf="totalPages > 1">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="page === 1">
          <a class="page-link" (click)="onPageChange(page - 1)" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
        <li class="page-item" *ngFor="let p of pages" [class.active]="p === page" [class.disabled]="p === -1">
          <ng-container *ngIf="p === -1; else clickablePage">
            <span class="page-link">...</span>
          </ng-container>
          <ng-template #clickablePage>
            <a class="page-link" (click)="onPageChange(p)">{{ p }}</a>
          </ng-template>
        </li>
        <li class="page-item" [class.disabled]="page === totalPages">
          <a class="page-link" (click)="onPageChange(page + 1)" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>

  <ng-template #noUsers>
    <div class="alert alert-info mt-3" role="alert">
      {{ 'USER_LIST.NO_USERS_FOUND' | translate }}
    </div>
  </ng-template>
</div>

<ng-template #viewUserModal>
  <div class="modal-header">
    <h4 class="modal-title pull-left">{{ 'USER_LIST.MODAL.VIEW_TITLE' | translate }}</h4>
    <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body" *ngIf="selectedUser">
    <div class="row mb-2">
      <div class="col-md-4"><strong>ID:</strong></div>
      <div class="col-md-8">{{ selectedUser.id }}</div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.NAME' | translate }}:</strong></div>
      <div class="col-md-8">{{ selectedUser.name }} {{ selectedUser.last_name }}</div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.AGE' | translate }}:</strong></div>
      <div class="col-md-8">{{ selectedUser.age }}</div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.HEIGHT' | translate }}:</strong></div>
      <div class="col-md-8">{{ selectedUser.height | number:'1.2-2' }} m</div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.WEIGHT' | translate }}:</strong></div>
      <div class="col-md-8">{{ selectedUser.weight | number:'1.2-2' }} kg</div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.ARM' | translate }}:</strong></div>
      <div class="col-md-8">{{ selectedUser.arm | number:'1.1-1' }} cm</div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.CHEST' | translate }}:</strong></div>
      <div class="col-md-8">{{ selectedUser.chest | number:'1.1-1' }} cm</div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.WAIST' | translate }}:</strong></div>
      <div class="col-md-8">{{ selectedUser.waist | number:'1.1-1' }} cm</div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.LEG' | translate }}:</strong></div>
      <div class="col-md-8">{{ selectedUser.leg | number:'1.1-1' }} cm</div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.CREATED_AT' | translate }}:</strong></div>
      <div class="col-md-8">{{ selectedUser.created_at | date:'medium' }}</div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.UPDATED_AT' | translate }}:</strong></div>
      <div class="col-md-8">{{ selectedUser.updated_at | date:'medium' }}</div>
    </div>
    <div class="row mb-2">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.WITHDRAWAL_STATUS' | translate }}:</strong></div>
      <div class="col-md-8">
        <span class="badge" [ngClass]="{'bg-success': !selectedUser.withdrawal_date, 'bg-danger': selectedUser.withdrawal_date}">
          {{ selectedUser.withdrawal_date ? ('COMMON.NO' | translate) : ('COMMON.YES' | translate) }}
        </span>
      </div>
    </div>
    <div class="row mb-2" *ngIf="selectedUser.withdrawal_date">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.WITHDRAWAL_DATE' | translate }}:</strong></div>
      <div class="col-md-8">{{ selectedUser.withdrawal_date }}</div>
    </div>
    <div class="row mb-2" *ngIf="selectedUser.withdrawal_reason">
      <div class="col-md-4"><strong>{{ 'USER_LIST.MODAL.WITHDRAWAL_REASON' | translate }}:</strong></div>
      <div class="col-md-8">{{ selectedUser.withdrawal_reason }}</div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modalRef?.hide()">
      {{ 'COMMON.CLOSE' | translate }}
    </button>
  </div>
</ng-template>

<ng-template #deleteUserModal>
  <div class="modal-header">
    <h4 class="modal-title pull-left">{{ 'USER_LIST.MODAL.DELETE_TITLE' | translate }}</h4>
    <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    {{ 'USER_LIST.MODAL.DELETE_CONFIRMATION' | translate }} <strong>{{ selectedUser?.name }} {{ selectedUser?.last_name }} (ID: {{ selectedUser?.id }})</strong>?
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modalRef?.hide()">
      {{ 'COMMON.CANCEL' | translate }}
    </button>
    <button type="button" class="btn btn-danger" (click)="confirmDelete()">
      {{ 'COMMON.DELETE' | translate }}
    </button>
  </div>
</ng-template>

<ng-template #withdrawUserModal>
  <div class="modal-header">
    <h4 class="modal-title pull-left">{{ 'USER_LIST.MODAL.WITHDRAW_TITLE' | translate }}</h4>
    <button type="button" class="btn-close close pull-right" aria-label="Close" (click)="modalRef?.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    {{ 'USER_LIST.MODAL.WITHDRAW_CONFIRMATION' | translate }} <strong>{{ selectedUser?.name }} {{ selectedUser?.last_name }} (ID: {{ selectedUser?.id }})</strong>?
    <p class="mt-2">{{ 'USER_LIST.MODAL.WITHDRAW_NOTICE' | translate }}</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modalRef?.hide()">
      {{ 'COMMON.CANCEL' | translate }}
    </button>
    <button type="button" class="btn btn-primary" (click)="confirmWithdraw()">
      {{ 'USER_LIST.MODAL.CONFIRM_WITHDRAW' | translate }}
    </button>
  </div>
</ng-template>